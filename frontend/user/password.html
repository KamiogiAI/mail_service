<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>パスワード変更</title>
    <link rel="stylesheet" href="../assets/common.css">
</head>
<body>
    <header class="header">
        <h1><a href="/index.html"><span class="site-name">Mail Service</span></a></h1>
        <nav id="header-nav">
            <a href="/user/mypage.html">マイページ</a>
            <a href="#" onclick="siteLogout();return false;">ログアウト</a>
        </nav>
    </header>

    <div class="container-narrow">
        <div class="page-card">
            <h2>パスワード変更</h2>
            <div class="form-group">
                <label>現在のパスワード</label>
                <input id="current-pw" type="password">
            </div>
            <div class="form-group">
                <label>新しいパスワード</label>
                <input id="new-pw" type="password">
                <small>8文字以上</small>
            </div>
            <button class="btn btn-block" onclick="changePw()">変更する</button>
            <div id="pw-msg" class="success-message"></div>
            <div id="pw-err" class="error-message"></div>
        </div>
    </div>

    <footer>
        <a href="/pages.html?type=terms">利用規約</a>
        <a href="/pages.html?type=company">運営会社</a>
        <a href="/pages.html?type=tokusho">特定商取引法</a>
    </footer>

    <script src="/assets/site.js"></script>
    <script src="js/api.js"></script>
    <script>
        async function changePw() {
            const msgEl = document.getElementById('pw-msg');
            const errEl = document.getElementById('pw-err');
            msgEl.textContent = '';
            errEl.textContent = '';
            try {
                await API.put('/api/me/password', {
                    current_password: document.getElementById('current-pw').value,
                    new_password: document.getElementById('new-pw').value,
                });
                msgEl.textContent = 'パスワードを変更しました';
                document.getElementById('current-pw').value = '';
                document.getElementById('new-pw').value = '';
            } catch (e) {
                errEl.textContent = e.message;
            }
        }
    </script>
</body>
</html>
